-----------------------------------------------------------------------
|  CHAPTER 3 - DATABASES                                              |
-----------------------------------------------------------------------

- Database Packages

    - We'll be using Postgres as our database.  We will use the 'psycopg2' package to connect
        our Flask application to it.  We could also use 'pgAdmin' for GUI management of
        the DB if we wanted to.

    - We'll use SQLAlchemy as our ORM.

    - We'll use Flask-Migrate to handle the migrations.

    - We'll use 'passlib' to hash passwords.

    - Add these packages to 'requirements.txt':

        Flask-SQLAlchemy==2.4.0
        Flask-Migrate==2.5.2
        psycopg2==2.8.3
        passlib==1.7.1



- Creating the Database

    $ sudo su - postgres
    $ psql

    > CREATE DATABASE smilecook;
    > CREATE USER smilecookuser WITH PASSWORD 'smilecookuser';
    > GRANT ALL PRIVILEGES ON DATABASE smilecook TO smilecookuser;



- Creating the User Model

    - Attributes

        id
        username      # Unique
        email         # Unique
        password
        is_active
        recipes       # Join table relationship
        created_at
        updated_at

    - Methods

        get_by_username
        get_by_email



- Creating the Recipe Model

    - Attributes

        id
        name
        description
        num_of_servings
        cook_time
        directions
        is_publish
        created_at
        updated_at



- Creating the Config.py and extensions.py files

    - Create a 'Config.py' file in the project root.

        # smilecook/config.py
        -----------------------------
        class Config:
            DEBUG = True

            SQLALCHEMY_DATABASE_URI = 'postgresql://smilecookuser:smilecookpw@localhost/smilecook'
            SQLALCHEMY_TRACK_MODIFICATIONS = False


    - Create a 'extensions.py' file in the project root.

        # smilecook/extensions.py
        -----------------------------
        from flask_sqlalchemy import SQLAlchemy

        db = SQLAlchemy()



- Adding the Models

    - Create the User model in 'models/user.py'.

    - Next, change the Recipe model in 'models/recipe.py'.

    - Next, we'll update 'app.py' to import all of our necessary packages and add a
        'create_app' function to create the app.

        # app.py
        ------------------------------------
        from flask import Flask
        from flask_migrate import Migrate
        from flask_restful import Api

        from config import Config
        from extensions import db
        from models.user import User
        from resources.recipe import RecipeListResource, RecipeResource, RecipePublishResource


        def create_app():
            app = Flask(__name__)
            app.config.from_object(Config)

            register_extensions(app)
            register_resources(app)
            return app

        def register_extensions(app):
            db.init_app(app)
            migrate = Migrate(app, db)

        def register_resources(app):
            api = Api(app)

            api.add_resource(RecipeListResource, '/recipes')
            api.add_resource(RecipeResource, '/recipes/<int:recipe_id>')
            api.add_resource(RecipePublishResource, '/recipes/<int:recipe_id>/publish')


        if __name__ == '__main__':
            app = create_app()
            app.run()